<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./styles.css">
    <title>Document</title>
    
</head>
<body>
    <button id="debugger">test debug</button>
    <script>
//Selectors
const body = document.querySelector('body');
const head = document.querySelector('head');

//Creating parent element, overlay-child and close-child button
const ParentElement = document.createElement('div');
const XButton = document.createElement('img');
const overlay = document.createElement('img');

//Adding JQuery to DOM
const JQuery = document.createElement('script');
JQuery.src = 'https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js';
head.appendChild(JQuery);

//Adding CSS file to DOM
const CustomCSS = document.createElement('link');
CustomCSS.rel = 'stylesheet';
CustomCSS.href = './styles.css';
head.appendChild(CustomCSS);

//Create Parent Element
ParentElement.classList = 'ParentElement';
body.appendChild(ParentElement);

//Style & Position Overlay
overlay.id = 'Overlay';
overlay.src = './Sale50_Desktop.jpg';
ParentElement.appendChild(overlay);

//Style & Position XButton
XButton.id = 'CloseButton';
XButton.src = './XButton.png';
ParentElement.appendChild(XButton);

// Trigger Overlay
document.onmouseleave = () => { 
  let Newtimestamp = new Date().getTime();

  //Read All Cookies from site and turn string into object and then search for OverlayViewed Cookie
  let cookies = document.cookie
  .split(';')
  .map(cookie => cookie.split('='))
  .reduce((accumulator, [key, value]) => ({ ...accumulator, [key.trim()]: decodeURIComponent(value) }), {});
  let OldTimestamp = cookies.OverlayViewed;

  let durationSinceLastViewed = new Date(Newtimestamp-OldTimestamp).getSeconds();
  //Store current timestamp in cookie
  document.cookie = `OverlayViewed=${Newtimestamp}`;
  if(!OldTimestamp || durationSinceLastViewed>=10){
  // Set internal cookie
   ParentElement.style = 'display: block';
  }
};

//Close Overlay
XButton.onclick = () => { 
  ParentElement.style = 'display: none';
};

    </script>
</body>
</html>
